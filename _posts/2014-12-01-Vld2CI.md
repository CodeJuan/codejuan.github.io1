---
layout: post
title: VLD集成到CI自动化检测内存泄露
comments: true
---

# VLD简介

> Visual Leak Detector is a free, robust, open-source memory leak detection system for Visual C++. 

windows下VC常用开源内存泄露检测工具，代码在[codeplex](http://vld.codeplex.com/)

## 原理
代码中include了vld.h，在运行时会构建一个VisualLeakDetector g_vld的全局变量，此时会接管申请内存和释放内存的操作。
此后会记录每次申请内存，并将地址及call stack存到一个set；释放内存时会删除set中与之相匹配的内存申请记录。
在程序结束时，vld会遍历此set，如果set不为空，说明有内存泄露，会将泄露地址及call stack输出到report中。


{% highlight bat %}  
copy /y vld.h %CODE_HOME%\opensrc\include\
{% endhighlight %}  
